library(ncdf4)
?nc_open
library(plotutils)
library(devtools)
install_github("jmuelmen/plotutils")
3
nc.to.df
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc")
names(nc$var)
names(nc$var)[-1]
df <- nc.to.df(nc, names(nc$var)[-1])
str(df)
names(df)
gsub("_210e_to_245e_15n_to_35n", "", names(df))
names(df) <- gsub("_210e_to_245e_15n_to_35n", "", names(df))
str(df)
df %<>% mutate(is.scu = OMEGA500 * 86400 > 10e2 & TH7001000 > 18.55)
library(magrittr)
df %<>% mutate(is.scu = OMEGA500 * 86400 > 10e2 & TH7001000 > 18.55)
library(plyr)
library(dplyr)
df %<>% mutate(is.scu = OMEGA500 * 86400 > 10e2 & TH7001000 > 18.55)
str(df)
summary(df)
nc_close(nc)
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc", write = TRUE)
var.is_scu <- ncvar_def("is_scu", "", list(nc$dim$time, nc$dim$ncol_210e_to_245e_15n_to_35n), NA)
var.is_scu
?ncvar_add
?ncvar_add
?ncvar_put
ncvar_add(nc, var.is_scu, verbose = TRUE)
ncvar_put(nc, var.is_scu, df$is.scu)
nc
nc_close(nc)
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc", write = TRUE)
nc
nc_close(nc)
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc", write = TRUE)
nc
nc_close(nc)
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc", write = FALSE)
nc
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc", write = TRUE)
nc_close(nc)
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc", write = TRUE)
var.is_scu <- ncvar_def("is_scu", "", list(nc$dim$ncol_210e_to_245e_15n_to_35n, nc$dim$time), NA)
ncvar_add(nc, var.is_scu)
nc
nc <- ncvar_add(nc, var.is_scu)
nc
nc_close(nc)
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc", write = TRUE)
var.is_scu <- ncvar_def("is_scu", "", list(nc$dim$ncol_210e_to_245e_15n_to_35n, nc$dim$time), NA)
nc <- ncvar_add(nc, var.is_scu)
nc
ncvar_put(nc, var.is_scu, df$is.scu)
nc_close(nc)
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc", write = TRUE)
var.is_scu <- ncvar_def("is_scu_210e_to_245e_15n_to_35n", "", list(nc$dim$ncol_210e_to_245e_15n_to_35n, nc$dim$time), NA)
nc <- ncvar_add(nc, var.is_scu)
ncvar_put(nc, var.is_scu, df$is.scu)
nc_close(nc)
df.mean <- ddply(df, ~ncol, colMeans)
str(df.mean)
summary(df.mean)
which.max(df$is.scu)
df %>% slice(1955)
which.max(df.mean$is.scu)
df.mean %>% slice(290)
history()
library(help = plotutil)
library(help = plotutils)
?remap
with(df.mean, plot(ncol, is.scu))
nc2 <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000-01-27-00000.nc")
names(nc2$var)
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc", write = TRUE)
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc")
nc
names(nc$var)
nc
346 * 17520
rlang::last_error()
rlang::last_trace()
vars <- names(nc$var)[-(1:3)]
vars
nc <- nc_open("../vignettes/EAMv1_entrain_NEP.cam.h1.2000_scu.nc")
nc
q()
n
str(df)
str(df)
summary(df)
df.lon.lat
df.lon.lat
str(df.mean)
str(df.lon.lat)
str(df.mean)
df.remap <- remap(df.mean, expand.grid(lon = 210:245, lat = 15:35))
df.remap <- remap(df.mean %>% select(-ncol), expand.grid(lon = 210:245, lat = 15:35))
df.remap <- remap(df.mean %>% select(-ncol), expand.grid(lon = seq(210,245,0.1), lat = seq(15,35,0.1)))
df.remap <- remap(df.mean %>% select(-ncol), expand.grid(lon = seq(210,245,0.01), lat = seq(15,35,0.01)))
df.remap <- remap(df.mean %>% select(-ncol), expand.grid(lon = seq(210,245,0.01), lat = seq(15,35,0.01)))
df.remap <- remap(df.mean %>% select(-ncol), expand.grid(lon = 210:245, lat = 15:35))
str(df.remap)
summary(df.remap)
str(df.mean)
summary(df.mean)
library(ggplot2)
ggplot(df.mean, aes(lon, lat, col = OMEGA700))
ggplot(df.mean, aes(lon, lat, col = OMEGA700)) + geom_point
ggplot(df.mean, aes(lon, lat, col = OMEGA700)) + geom_point()
ggplot(df.mean, aes(lon, lat, col = OMEGA700)) + geom_point() + scale_color_distiller(palette = "Spectral")
ggplot(df.mean, aes(lon, lat, col = OMEGA700)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral")
str(df.mean)
ggplot(df.mean, aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral")
ggplot(df.mean, aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral") + geom_world_polygon()
ggplot(df.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral") + geom_world_polygon()
ggplot(df.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo()
df.remap <- remap(df.mean %>% select(-ncol), expand.grid(lon = 210:245, lat = 15:35))
summary(df.remap)
df.src <- df.mean %>% select(-ncol); df.dest <- expand.grid(lon = 210:245, lat = 15:35)
fill <- 0
str(df.template)
library(help = akima)
df.remap <- remap(df.mean %>% select(-ncol), expand.grid(lon = 210:245, lat = 15:35))
str(df.remap)
summary(df.remap)
X11(); )ggplot(df.remap %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo()
ggplot(df.remap %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo()
ggplot(df.remap %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 1) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo()
ggplot(df.remap %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 0.5) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo()
ggplot(df.remap %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo()
df.mean %>% filter(is.scu > 0.5)
df.mean %>% filter(is.scu >= 0.5)
df %<>% mutate(time = as.POSIXct("1999-10-01") + 86400 * time)
str(df)
df %<>% mutate(time = as.POSIXct("1999-10-01", tz = "UTC") + 86400 * time)
df %<>% mutate(time = as.POSIXct("1999-10-01", tz = "UTC") + 86400 * time)
str(df)
str(df)
rm(df)
str(df)
str(df)
str(df)
df %<>% mutate(time = as.POSIXct("1999-10-01", tz = "UTC") + 86400 * time)
str(df)
months(df$time) %>% table
str(time)
str(df)
q()
n
str(df)
str(df.lon.lat)
str(df)
str(df)
str(df.monthly.mean)
str(df.monthly.mean)
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month)
library(ggplot2)
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month)
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 1) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month)
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 1) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month) + xlim(c(-160, -110))
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 1) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month) + xlim(c(-160, -110)) + xlim(c(15,35))
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 1) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month) + xlim(c(-160, -110)) + ylim(c(15,35))
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 1) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month) + coord_cartesian(xlim = c(-160, -110), ylim = c(15,35))
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 1) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month) + coord_cartesian(xlim = c(-160, -110), ylim = c(10,40))
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 2) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month) + coord_cartesian(xlim = c(-160, -110), ylim = c(10,40))
ggplot(df.monthly.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 5) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + facet_wrap(~ month) + coord_cartesian(xlim = c(-160, -110), ylim = c(10,40))
df.monthly.mean %>% slice(which.max(df.monthly.mean$is.scu))
ggplot(df.jjas.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 1) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo() + xlim(c(-160, -110)) + xlim(c(15,35))
ggplot(df.jjas.mean %>% mutate(lon = ifelse(lon > 180, lon - 360, lon)), aes(lon, lat, col = is.scu)) + geom_point(size = 1) + scale_color_distiller(palette = "Spectral") + geom_world_polygon() + scale_x_geo() + scale_y_geo()
str(df)
df.monthly.mean %>% slice(which.max(df.monthly.mean$is.scu))
df.jjas.mean %>% slice(which.max(df.monthly.mean$is.scu))
df.jjas.mean %>% slice(which.max(df.jjas.mean$is.scu))
df.jjas.mean %>% slice(which.max(df.jjas.mean$is.scu)) %>% mutate(lon = lon - 360)
df %>% filter(ncol == 316) %>% ggplot(aes(x = time, y = OMEGA500)) + geom_line()
df.max.scu %>% ggplot(aes(x = time, y = OMEGA500)) + geom_line()
library(tidyr)
library(help = tidyr)
pwd()
